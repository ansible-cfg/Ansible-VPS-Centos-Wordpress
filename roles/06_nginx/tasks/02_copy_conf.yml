---
- name: Ensure that directory /etc/nginx/ssl exist
  file:
    path: /etc/nginx/ssl
    state: directory

- name: Copy dhparam.pem file
  copy:
    src: dhparam.pem
    dest: /etc/nginx/ssl/dhparam.pem
    mode: 0664

- name: nginx.conf
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    backup: yes

- name: nginx virtualhost file
  template:
    src: vhost.conf.j2
    dest: /etc/nginx/conf.d/{{ site }}.conf
  notify: restart nginx
